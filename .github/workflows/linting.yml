name: rider linting

on: push

jobs:
  check-format:
    runs-on: self-hosted

    steps:
#      - name: Setup .NET Core
#        uses: actions/setup-dotnet@v1
#      - name: Install resharper global tools
#        run: dotnet tool install -g JetBrains.ReSharper.GlobalTools
      - name: Check out code
        uses: actions/checkout@v3
      - name: Run rider inspect
        run: jb inspectcode ${{ github.workspace }}\unity-rider-linting.sln --output=inspect-log.txt --format=text --severity=WARNING --no-build --eXtensions=JetBrains.Unity
      - name: Check errors
        shell: python
        run: |
          import sys
          import os
          PATH = os.getenv('GITHUB_WORKSPACE')+'\\inspect-log.txt'
          print(PATH)
          file = open(PATH,"r")
          lines = file.readlines()
          file.close()
          line_count = len(lines)
          print(f"There are {line_count} lines")
          if line_count > 0:
            os.system("cat " + PATH)
      - name: Upload artifact
        uses: actions/upload-artifact@v3
        if: always()
        with:
          name: inspect-log
          path: ${{ github.workspace }}\inspect-log.txt
